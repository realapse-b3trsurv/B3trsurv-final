<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B3TRSURVE</title>
    
    <script>
      // 1. Fix Global & Process
      window.global = window;
      window.process = { env: { DEBUG: undefined }, version: '' };
      
      // 2. Fix 'Buffer' (Manual load so it's instant)
      const Buffer = {
        isBuffer: function(obj) { 
          return obj != null && obj.constructor != null && 
                 typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj); 
        },
        from: function(data) { 
          if (typeof data === 'string') {
            const arr = new Uint8Array(data.length);
            for (let i = 0; i < data.length; i++) arr[i] = data.charCodeAt(i);
            return arr;
          }
          return new Uint8Array(data); 
        },
        alloc: function(size) { return new Uint8Array(size); },
        concat: function(list) {
          let length = 0;
          for (let i = 0; i < list.length; i++) length += list[i].length;
          const result = new Uint8Array(length);
          let offset = 0;
          for (let i = 0; i < list.length; i++) {
            result.set(list[i], offset);
            offset += list[i].length;
          }
          return result;
        }
      };
      window.Buffer = Buffer;

      // 3. THE CRASH FIX (The 'require' stub)
      // If any library shouts "require!", we catch it here.
      window.require = function(name) {
        console.log("Require caught for: " + name);
        if (name === 'buffer') return { Buffer: Buffer };
        if (name === 'process') return window.process;
        return {}; // Return empty object to prevent crash
      };
    </script>
    
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
